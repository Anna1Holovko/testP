<!--
  @File Name          : CreateRefundPage.page
  @Description        : 
  @Author             : nick@bkonect.com
  @Group              : 
  @Last Modified By   : nick@bkonect.com
  @Last Modified On   : 9/25/2019, 11:24:46 AM
  @Modification Log   : 
  Ver       Date            Author      		    Modification
  1.0    9/25/2019   nick@bkonect.com     Initial Version
-->
<apex:page standardController="Sales_Order__c" extensions="RefundController" sidebar="false" showHeader="false" id="pageId">
    <apex:form id="formId">
        <apex:stylesheet value="{!URLFOR($Resource.renegade_stylesheet)}" />    
        <html>
            <head>
                <title>Generate Credit Memo</title>
                <apex:includeScript value="{!URLFOR($Resource.jquery_modal ,'/jquery.min.js')}"/>
                <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
                
                <apex:includeScript value="{!URLFOR($Resource.jquery_modal ,'/jquery.modal.min.js')}"/>
                <apex:stylesheet value="{!URLFOR($Resource.jquery_modal ,'/jquery.modal.min.css')}"/>
                
                <script type="text/javascript">
                /***************** Page Redirection ******************/
                
                function goToHomePage() {
                    window.location = '/home/home.jsp';
                }
                /***************** Page Redirection ******************/
                function showDialog() {
                    if({!showShippingAlert}){//hasError
                        $("#shippingModal").modal();
                    }
                } 

                $(document).ready(function(){
                    
                    var rowCount = $('.table-fixed tr').length;
                    if(rowCount > 4){
                        $( ".table-fixed>thead" ).css( "width", "97.7" + "%");
                        $( ".table-fixed>tbody" ).css( "height", "320" + "px");
                    }
                    else{
                        $( ".table-fixed>thead" ).css( "width", "99.3" + "%");
                        $( ".table-fixed>tbody" ).css( "height", "auto");
                    }
                    showDialog();
                });
                
                function lockSubmitButtons() {
                    setControllButtonsAvailability(true);
                }

                function unLockSubmitButtons() {
                    setControllButtonsAvailability(false);
                }

                function setControllButtonsAvailability(disabledValue) {
                    var buttons = document.getElementsByClassName('refund-control-btns');
                    [...buttons].forEach(elem => {
                        elem.disabled = disabledValue;
                    });
                }
                </script>
                <style>
                    .colHeadr {
                    text-align: center;
                    }
                    body .pbBody table.list tr.dataRow th, body .pbBody table.list tr.dataRow td
                    {
                    border-width: 0 0 1px 0;
                    vertical-align: middle;
                    text-align: center;
                    }
                    .sfdc_richtext img {
                    border: 0;
                    width: 70px !important;
                    height: 45px !important;
                    }
                    .apexp .bPageBlock.apexDefaultPageBlock .pbBody {
                    margin: 0;
                    }
                    .bPageBlock .detailList .dataCol {
                    width: 0 !important;
                    }
                    .bPageBlock .detailList .labelCol {
                    width: 0 !important;
                    }
                    .bPageBlock .labelCol {
                    padding-right: 0px !important;
                    padding-left: 0px !important;
                    }
                    .bPageBlock .dataCol {
                    padding-right: 0px !important;
                    padding-left: 5px;
                    }
                    .labelCol, body .print .topics-label {
                    color: #4a4a56;
                    padding-top: 5px;
                    padding-bottom: 5px;
                    }
                    .totals-div {
                    padding: 35px 20px 15px 0px;
                    float: left;
                    width: 100%;
                    }
                    .total-div-rows {
                    float: right;
                    width: 95%;
                    padding: 5px 30px;
                    text-align: right;
                    }
                    .total-div-row-label {
                    font-weight: bold;
                    font-size: 13px;
                    }
                    .total-div-row-grand {
                    font-weight: bold;
                    font-size: 16px;
                    }
                    .td-flds-div {
                    width: 100%;
                    float: left;
                    padding: 5px 0px;
                    }
                    .Order-info-heading {
                    background: #6f8992;
                    padding: 2px 10px;
                    font-weight: bold;
                    color: #fff;
                    font-size: 1em;
                    line-height: 18px;
                    min-height: 0;
                    }
                    .order-details-content {
                    border: 1px solid #d6d6d6;
                    background: #fafafa;
                    width: 96.6%;
                    float: left;
                    padding: 10px;
                    }
                    .invoice-content-container {
                    width: 100%;
                    float: left;
                    }
                    .invoice-content-inner-container {
                    width: 90%;
                    margin: 1% auto 0%;
                    }
                    .individualPalette .Custom8Block .tertiaryPalette {
                    background-color: #6f8992 !important;
                    }
                    .Order-invoice-heading {
                    background: #6f8992;
                    padding: 2px 10px;
                    font-weight: bold;
                    color: #fff;
                    font-size: 1em;
                    line-height: 18px;
                    min-height: 0;
                    width: 100%;
                    }
                    .message {
                    border-radius: 4px;
                    margin-bottom: 20px;
                    }
                    .bill-add-rows {
                    width: 100%;
                    float: left;
                    padding: 5px 0px;
                    }                    
                    <!--.table-fixed thead {width: 97%;}-->     
                    .legend-add-label{
                    font-size: 18px;
                    color: #428BCA;
                    }
                    .table-fixed tbody td{
                    line-height: 3.8;
                    }
                    body .btn{
                    background: #69c5ec !important;
                    outline:0 !important;
                    }
                    .invoice-table-fld-th {
                    width: 6.05%;
                    text-align: center;
                    }
                    .invoice-table-fld-first-th {
                    width: 16%; !important;
                    }
                    
                    .inv-table>thead>tr>th {
                    vertical-align: bottom;
                    border-bottom: 1px solid #ddd;
                    background-color: #F7F7F7;
                    width: 83px;
                    }
                    #pageId\3a formId\3a j_id69_lkwgt{border:none !important;}
                    .inv-inner-table{
                    width: 100%;
                    overflow-y: auto;
                    }
                    .inv-inner-table>thead>tr>th {
                    vertical-align: bottom;
                    border-bottom: 1px solid #ddd;
                    background-color: #F7F7F7;
                    }
                    body input[type=text] {
                    height: 27px !important;
                    border-radius: 3px !important;
                    border: 1px solid #ccc !important;
                    padding: 0px 5px 0px 10px !important;
                    }
                    body select {
                    height: 27px !important;
                    border-radius: 3px !important;
                    padding: 0px 5px 0px 10px !important;
                    }

                    .reward-aplay{
                        font-weight: bold;
                        color:black;
                    }
                    .reward-not-aplay{
                        color:black;
                    }
                    
                </style>
            </head>
            <body>  
                <div id="shippingModal" class="modal">
                    <p>Shipping fee must be confirmed with the accounting team</p>
                </div> 
                <apex:outputpanel >
                    <apex:actionstatus id="message">
                        <apex:facet name="start">
                            <div class="waitingSearchDiv" id="el_loading" style="background-color: #DCD6D6;height:100%;opacity:0.65;width:100%;position:fixed;"> 
                                <div class="waitingHolder" style="top:120.2px; width: 91px;">
                                    <img class="waitingImage" src="{!$Resource.loading}" title="Please Wait..." />
                                    <span class="waitingDescription">Loading...</span>
                                </div>
                            </div>
                        </apex:facet>
                    </apex:actionstatus>
                </apex:outputpanel>
                <div id="main-wrapper">
                    <!-- Header effect -->
                    <div class="effect6">
                        <div class="header_container">
                            <apex:image value="{!$Resource.coleman_header_logo}" />
                            <div style="float:right;width: 19%;padding: 20px 40px;float:right;">
                                <apex:commandButton immediate="true" status="message" id="Cancel" value="Cancel" action="/{!Sales_Order__c.id}" styleClass="Header-btns" style="background: #F3F3F3 !important;font-size:11px;margin-right:0px;float:right;"/>
                                <apex:commandButton status="message" id="home" value="Home Page" oncomplete="goToHomePage()" styleClass="Header-btns" style="background: #F3F3F3 !important;font-size:11px;float:right;margin-right:10px"/>
                            </div>
                            
                        </div>
                    </div>
                    <!--end of Header effect -->
                    <div class="create-iv-content_container" style="margin-top: 100px;">
                        <apex:pageMessages id="errorMsgId"></apex:pageMessages>
                        <apex:outputPanel rendered="{!isRefundItemsExist}">
                            <div class="invoice-details-div">
                                <h3>New Credit Memo for Sales Order #{!SO_Obj.Magento_order_No__c}</h3>
                            </div>
                            <fieldset class="fieldset1 address-fld">
                                <fieldset class="inner" style="margin-right: 27px;padding-bottom:44px;">
                                    <legend class="invoice-legend-add-label">Order Details:</legend>
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label">Order Date :</label>
                                        <apex:outputText value="{0, date, MMMM d','  yyyy hh:mm:ss a}"
                                                         label="Order Date" style="margin-left:5px">
                                            <apex:param value="{!SO_Obj.Order_Date__c}" />
                                        </apex:outputText>
                                    </div>
                                    <br />
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label">Order Status : </label>
                                        <apex:outputText value="{!SO_Obj.Order_Status__c}"
                                                         style="margin-left:5px"></apex:outputText>
                                    </div>
                                    <br />
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label">Order Type :</label>
                                        <apex:outputText value="{!SO_Obj.Order_Type__c}"
                                                         style="margin-left:5px"></apex:outputText>
                                    </div>
                                    <br />
                                </fieldset>
                                <fieldset class="inner">
                                    <legend class="invoice-legend-add-label">Customer Information:</legend>
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label"> Customer Name : </label>
                                        <apex:outputText value="{!SO_Obj.Customer_Name__r.name}"></apex:outputText>
                                    </div>
                                    <br />
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label"> Email : </label>
                                        <apex:outputText value="{!SO_Obj.Customer_Email__c}"></apex:outputText>
                                    </div>
                                    <br />
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label"> Telephone : </label>
                                        <apex:outputText value="{!SO_Obj.Customer_Name__r.Phone}"></apex:outputText>
                                    </div>
                                    <br />
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label"> Mobile : </label>
                                        <apex:outputText value="{!SO_Obj.Mobile__c}"></apex:outputText>
                                    </div>
                                    <br />
                                </fieldset>
                            </fieldset>
                            <br />
                            <br />
                            <fieldset class="fieldset1 address-fld">
                                <fieldset class="inner" style="margin-right: 27px;">
                                    <legend class="invoice-legend-add-label">Billing Address:</legend>
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label">Bill to : </label>
                                        <apex:outputText value="{!SO_Obj.Bill_To__c}"></apex:outputText>
                                    </div>
                                    <br />
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label">Billing Street : </label>
                                        <apex:outputText value="{!SO_Obj.Billing_Street__c}"></apex:outputText>
                                    </div>
                                    <br />
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label">Billing City : </label>
                                        <apex:outputText value="{!SO_Obj.Billing_City__c}"></apex:outputText>
                                    </div>
                                    <br />
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label">Billing State/Province : </label>
                                        <apex:outputText value="{!SO_Obj.Billing_State__c} "></apex:outputText>
                                    </div>
                                    <br />
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label">Billing Zip/Postal Code :
                                        </label>
                                        <apex:outputText value="{!SO_Obj.Billing_ZipCode__c}"
                                                         label="BillingPostalCode" />
                                    </div>
                                    <br />
                                </fieldset>
                                <fieldset class="inner">
                                    <legend class="invoice-legend-add-label">Shipping Address:</legend>
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label">Ship to : </label>
                                        <apex:outputText value="{!SO_Obj.Ship_to__c}"></apex:outputText>
                                    </div>
                                    <br />
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label">Shipping Street : </label>
                                        <apex:outputText value="{!SO_Obj.Shipping_Street__c}"></apex:outputText>
                                    </div>
                                    <br />
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label">Shipping City : </label>
                                        <apex:outputText value="{!SO_Obj.Shipping_City__c}"></apex:outputText>
                                    </div>
                                    <br />
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label">Shipping State/Province :
                                        </label>
                                        <apex:outputText value="{!SO_Obj.Shipping_State__c} "></apex:outputText>
                                    </div>
                                    <br />
                                    <div class="invoice-bill-add-rows">
                                        <label class="inv-bill-add-label">Shipping Zip/Postal Code :
                                        </label>
                                        <apex:outputText value="{!SO_Obj.Shipping_ZipCode__c}"
                                                         label="ShippingPostalCode" />
                                    </div>
                                    <br />
                                </fieldset>
                            </fieldset>
                            <br />
                            <br />
                            <fieldset class="fieldset1 address-fld">
                                <fieldset class="inner" style="margin-right: 27px;">
                                    <legend class="invoice-legend-add-label">Payment Information: </legend>
                                    <apex:outputPanel rendered="{!NOT(isBlank(soRelatedList))}">
                                        <apex:actionRegion immediate="true">
                                        <div class="invoice-bill-add-rows">
                                            <!--label class="inv-bill-add-label">Refund Payment Type : </label-->
                                            <label class="inv-bill-add-label">Refund Transaction Type : </label>
                                            <div style="margin-left:20px;float:left">
                                                <apex:inputField value="{!invObj.Order_Transaction_Type__c}" style="border-left-color: #d74c3b !important;border-left-width: 3px !important; ">
                                                </apex:inputField>
                                                <div style="display:none"><apex:inputField value="{!invObj.Sales_Order__c}"></apex:inputField></div>
                                                <br/><apex:outputText value="Error: You must enter a value" style="color:#d74c3b;" rendered="{!isreqField}"/>
                                            </div>    
                                        </div>
                                        <br />
                                        <div class="invoice-bill-add-rows" style="margin-bottom:7px">
                                            <label class="inv-bill-add-label">Reason for Refund : </label>
                                            <div style="margin-left:20px;float:left">
                                                
                                                    <apex:selectList value="{!selectRefund}" required="true" size="1" multiselect="false" onChange="refDetail();" style="border-left-color: #d74c3b;border-left-width: 3px;margin-bottom: 5px;" disabled="{!isDisabledRedundOption}">
                                                    <apex:selectOptions value="{!selectRefundoption}"/> 
                                                    </apex:selectList>
                                                    <br/><apex:outputText value="Error: You must enter a value" style="color:#d74c3b;" rendered="{!isreqreasonField}"/>
                                                
                                                    <apex:actionFunction name="refDetail" action="{!isselectRefund}" rerender="formId,errorMsgId" status="message"/>
                                                
                                            </div>
                                        </div>
                                        </apex:actionRegion>
                                        <apex:outputPanel rendered="{!!if(selectRefund == 'Compensation' || selectRefund == 'none',true,false)}">
                                            <div class="invoice-bill-add-rows" style="margin-bottom:7px"> 
                                                <apex:outputLabel styleClass="inv-bill-add-label" value="Location of Furniture :" rendered="{!!if(selectRefund == 'GPP Cancellation' || selectRefund == 'Compensation' || selectRefund == 'Edited order' || selectRefund == 'none',true,false)}"></apex:outputLabel>
                                                <div style="margin-left:20px;float:left">
                                                    <apex:selectList value="{!selectLocation}" required="true" size="1" multiselect="false" style="border-left-color: #d74c3b;border-left-width:3px;" onChange="locDetail();" rendered="{!!if(selectRefund == 'GPP Cancellation' || selectRefund == 'Compensation' || selectRefund == 'Edited order' || selectRefund == 'none',true,false)}">
                                                        <apex:selectOptions value="{!selectLocationoption}"/>
                                                    </apex:selectList>
                                                    <br/><apex:outputText value="Error: You must enter a value" style="color:#d74c3b;" rendered="{!isreqLocationField}"/>
                                                    <apex:actionFunction name="locDetail" action="{!isselectCustomerLocation}" rerender="formId" status="message" />
                                                </div>
                                            </div>
                                        	<apex:outputPanel rendered="{!if(selectLocation == 'LTL Return Enroute to Consignment',true,false)}">
                                            <div class="invoice-bill-add-rows" style="margin-bottom:7px"> 
                                                <apex:outputLabel styleClass="inv-bill-add-label" value="Tracking Number :" rendered="{!if(selectLocation == 'LTL Carrier Pickup due to Damage' || selectLocation == 'LTL Return Enroute to Consignment',true,false)}"></apex:outputLabel>
                                                <div style="margin-left:20px;float:left">
                                                    <apex:inputText value="{!trackingNumber}" style="border-left-color: #d74c3b !important;border-left-width:3px !important;"  rendered="{!if(selectLocation == 'LTL Carrier Pickup due to Damage' || selectLocation == 'LTL Return Enroute to Consignment',true,false)}" />
                                                    <br/><apex:outputText value="Error: You must enter a value" style="color:#d74c3b;" rendered="{!isreqTrackingField}"/>
                                                </div>
                                            </div>
                                            </apex:outputPanel>
                                             <div class="invoice-bill-add-rows" style="margin-bottom:7px"> 
                                                <apex:outputLabel styleClass="inv-bill-add-label" value="Shipping Charge :" rendered="{!if(selectRefund == 'Cancellation' && selectLocation != 'LTL Carrier Pickup due to Damage' && selectLocation != 'LTL Return Enroute to Consignment' && selectLocation != 'En Route' && selectLocation != 'Confirmed Cancelled with Manufacturer',true,false)}"></apex:outputLabel>
                                                <div style="margin-left:20px;float:left">
                                                    <apex:selectList value="{!selectShippingCharge}" required="true" size="1" onchange="callupdatemethod();" multiselect="false" style="border-left-color: #d74c3b;border-left-width:3px;" rendered="{!if(selectRefund == 'Cancellation' && selectLocation != 'LTL Carrier Pickup due to Damage' && selectLocation != 'LTL Return Enroute to Consignment' && selectLocation != 'En Route' ,true,false)}">
                                                        <apex:selectOptions value="{!SelectShippingChargeOption}"/>
                                                    </apex:selectList>
                                                    <!--<br/><apex:outputText value="Error: You must enter a value" style="color:#d74c3b;" rendered="{!isreqLocationField}"/>
                                                    apex:actionFunction name="locDetail" action="{!isselectCustomerLocation}" rerender="formId" status="message" /-->
                                                </div>
                                            </div>

                                            <div class="invoice-bill-add-rows" style="margin-bottom:7px">
                                                <apex:outputLabel styleClass="inv-bill-add-label" value="Disposition of Furniture :" rendered="{!!if(selectRefund == 'GPP Cancellation' || selectRefund == 'Compensation' || selectRefund == 'Edited order' || selectRefund == 'none',true,false)}"></apex:outputLabel>
                                                <div style="margin-left:20px;float:left">
                                                    <apex:selectList value="{!selectConditioalFurniture}" required="true" size="1"  onchange="callupdatemethod()" multiselect="false" style="border-left-color: #d74c3b;border-left-width:3px;" rendered="{!!if( selectRefund == 'GPP Cancellation' || selectRefund == 'Compensation' || selectRefund == 'Edited order' || selectRefund == 'none',true,false)}">
                                                        <apex:selectOptions value="{!selectConditionaloption}"/>
                                                    </apex:selectList>
                                                    <br/><apex:outputText value="Error: You must enter a value" style="color:#d74c3b;" rendered="{!isreqConditionField}"/>
                                                </div>
                                            </div>
                                            <div class="invoice-bill-add-rows">
                                                <apex:outputLabel styleClass="inv-bill-add-label" value="Is Pickup Needed :" rendered="{!if(selectLocation == 'Customer Location' && selectRefund != 'Compensation',true,false)}"></apex:outputLabel>
                                                <apex:inputCheckbox value="{!isPickupNeeded}" style="margin-left: 20px;" rendered="{!if(selectLocation == 'Customer Location' && selectRefund != 'Compensation',true,false)}"/>
                                            </div>
                                        </apex:outputPanel>
                                        <apex:outputPanel rendered="{!if(selectRefund == 'Compensation',true,false)}">
                                            <div class="invoice-bill-add-rows" style="margin-bottom:7px">
                                                <apex:outputLabel styleClass="inv-bill-add-label" value="Compensation Reason :" rendered="{!if(selectRefund == 'Compensation',true,false)}"></apex:outputLabel>
                                                <div style="margin-left:20px;float:left">
                                                    <apex:selectList value="{!selectCompReason}" required="true" size="1" multiselect="false" style="border-left-color: #d74c3b;border-left-width:3px;" onchange="refComm()" rendered="{!if(selectRefund == 'Compensation',true,false)}">
                                                        <apex:selectOptions value="{!selectCompReasonoption}"/>
                                                    </apex:selectList>
                                                    <br/><apex:outputText value="Error: You must enter a value" style="color:#d74c3b;" rendered="{!isreqCompField}"/>
                                                </div>
                                            </div>
                                            
                                        </apex:outputPanel>
                                        <apex:actionFunction name="refComm" rerender="formId" status="message"/>
                                        
                                        <apex:outputPanel rendered="{!if(selectRefund == 'Cancellation' || selectRefund == 'GPP Cancellation',true,false)}">
                                            <div class="invoice-bill-add-rows" style="margin-bottom:7px">
                                                <apex:outputLabel styleClass="inv-bill-add-label" value="Cancellation Reason :" rendered="{!if(selectRefund == 'Cancellation' || selectRefund == 'GPP Cancellation',true,false)}"></apex:outputLabel>
                                                <div style="margin-left:20px;float:left"> 
                                                    <apex:selectList value="{!selectCanReason}" required="true" size="1" multiselect="false" style="border-left-color: #d74c3b;border-left-width:3px;" onchange="refComm()" rendered="{!if(selectRefund == 'Cancellation' || selectRefund == 'GPP Cancellation',true,false)}">
                                                        <apex:selectOptions value="{!selectCanReasonoption}"/>
                                                    </apex:selectList>
                                                    <br/><apex:outputText value="Error: You must enter a value" style="color:#d74c3b;" rendered="{!isreqCanField}"/>
                                                </div>
                                            </div>
                                            
                                        </apex:outputPanel>
                                            <div class="invoice-bill-add-rows" id="otherId">
                                                <apex:outputLabel styleClass="inv-bill-add-label" value="Comments :" rendered="{!if(selectCompReason == 'Other - Detail in Comments Below' || selectCanReason == 'Other - Detail in Comments Below' || selectRefund == 'Edited order',true,false)}"></apex:outputLabel>
                                                <apex:inputTextarea value="{!compensationComments}" style="border-left-color: #d74c3b;border-left-width:3px;" rendered="{!if(selectCompReason == 'Other - Detail in Comments Below' || selectCanReason == 'Other - Detail in Comments Below' || selectRefund == 'Edited order',true,false)}"/>
                                                    <br/><apex:outputText value="Error: You must enter a value" style="color:#d74c3b;" rendered="{!isreqCommField}"/>
                                            </div>
                                            
                                            <div class="invoice-bill-add-rows" style="margin-bottom:7px">
                                                <apex:outputLabel styleClass="inv-bill-add-label" value="At Cost To:" rendered="{!if(selectRefund == 'Compensation' || selectRefund == 'Cancellation',true,false)}"></apex:outputLabel>
                                                <div style="margin-left:20px;float:left">
                                                    <apex:selectList value="{!selectReason}" required="true" size="1" multiselect="false" style="border-left-color: #d74c3b;border-left-width:3px;" rendered="{!if(selectRefund == 'Compensation' || selectRefund == 'Cancellation',true,false)}">
                                                        <apex:selectOptions value="{!selectReasonoption}"/>
                                                    </apex:selectList>
                                                    <br/><apex:outputText value="Error: You must enter a value" style="color:#d74c3b;" rendered="{!isreqHandleField}"/>
                                                </div>
                                            </div>
                                            
                                        <apex:outputPanel rendered="{!if(selectRefund == 'Compensation',true,false)}">
                                            <div class="invoice-bill-add-rows" style="margin-bottom:7px">
                                                <apex:outputLabel styleClass="inv-bill-add-label" value="Form Of Compensation :" rendered="{!if(selectRefund == 'Compensation',true,false)}"></apex:outputLabel>
                                                <div style="margin-left:20px;float:left">
                                                    <apex:selectList value="{!selectForm}" required="true" size="1" multiselect="false" style="border-left-color: #d74c3b;border-left-width:3px;" rendered="{!if(selectRefund == 'Compensation',true,false)}">
                                                        <apex:selectOptions value="{!selectFormOfCompensationoption}"/>
                                                    </apex:selectList>
                                                    <br/><apex:outputText value="Error: You must enter a value" style="color:#d74c3b;" rendered="{!isreqFormField}"/>
                                                </div>
                                            </div>
                                        </apex:outputPanel>
                                    </apex:outputPanel>
                                    <apex:outputPanel rendered="{!!isRefundItemsExist}">
                                        <div class="invoice-bill-add-rows">
                                            <h1>
                                                Payment Information is not available.
                                            </h1>
                                        </div>
                                    </apex:outputPanel>
                                </fieldset>
                                <fieldset class="inner">
                                    <legend class="invoice-legend-add-label">Shipping Information:</legend>
                                    <div class="invoice-bill-add-rows" style="margin-bottom: 11px;">
                                        <b>Free Shipping - </b><apex:OutputText value="Total Shipping Charges: ${!SO_Obj.Shipping_Handle__c}" />
                                    </div>
                                </fieldset>
                            </fieldset>
                            <br />
                            <br />
                            <!-- test table -->
                            <div class="table-panel">
                                <div class="panel-heading">
                                    <h4>Items to Refund</h4> 
                                    <apex:inputCheckbox value="{!isRefundAll}" style="margin-left: 900px;" rendered="{!!if(selectRefund == 'Compensation' || selectRefund == 'none',true,false)}">
                                        <apex:actionSupport event="onchange" action="{!isClickedonRefund}" reRender="formId, rewardPoint" status="message" />
                                    </apex:inputCheckbox>
                                    <apex:outputText value=" Refund All Items" rendered="{!!if(selectRefund == 'Compensation' || selectRefund == 'none',true,false)}"></apex:outputText>
                                </div>
                                <table width="100%" class="inv-table table-fixed">
                                    <thead>
                                        <tr>
                                            <th class="invoice-table-fld-first-th" style="width:15%">Product</th>
                                            <th class="invoice-table-fld-th" style="width:6.05%">Image</th>
                                            <th class="invoice-table-fld-th" style="width:6.05%">Price</th>
                                            <th class="invoice-table-fld-th" style="width:6.05%">Custom Price</th>
                                            <apex:outputText escape="false" rendered="false"><!--{!if(selectRefund == 'Cancellation' || selectRefund == 'none',true,false)}-->
                                                <th class="invoice-table-fld-th" style="width:6.05%">Qty Ordered</th>
                                            </apex:outputText>
                                            <apex:outputText escape="false" rendered="true"><!--{!if(selectRefund == 'Compensation',true,false)}-->
                                                <th class="invoice-table-fld-th" style="width:6.05%">Qty Invoiced</th>
                                            </apex:outputText>
                                            <th class="invoice-table-fld-th" style="width:6.05%">Qty Refunded</th>
                                            <th class="invoice-table-fld-th" style="width:6.05%">Qty to Refund <!--input type="text" id="mytext" class="focus-section" style=" width: 10px !important;height: 10px !important; border-color: #6B3D3D !important;border-width: 0px !important; margin: 0;margin-top:-8px;"/--></th>
                                            <th class="invoice-table-fld-th" style="width:4.05%">Sub Total</th>
                                            <th class="invoice-table-fld-th" style="width:4%">Dis. Amt</th>
                                            <th class="invoice-table-fld-th" style="width:4%">Tax Amt</th>
                                            <th class="invoice-table-fld-th" style="width:4%">Total Paid</th>
                                            <th class="invoice-table-fld-th" style="width: 4.5%;">Wt. (lbs)</th>
                                            <th class="invoice-table-fld-th" style="width: 9.05%;">Custom Refund($)</th>
                                        </tr>
                                    </thead>
                                    <apex:actionFunction name="callupdatemethod"
                                                         action="{!onChangecalcInvoice}" reRender="formId,errorMsgId" status="message"/>
                                    <tbody>
                                        <apex:repeat id="pbtId" value="{!soRelatedList}" var="item">
                                            <apex:outputText escape="false" rendered="{!!if(selectRefund == 'Compensation' && soRelatedList[item].SoItem.Products__r.RecordType.Name == 'Protection Plan',true,false)}">
                                                <tr>
                                                    <td class="invoice-table-fld-first-th" style="line-height: 1.8;width:15%"><b>{!soRelatedList[item].SoItem.Product_Name__c} {!if(soRelatedList[item].SoItem.Item__c == 'Cancelled',' - Cancelled' ,'')}</b><br/>
                                                        <b>SKU : </b>{!soRelatedList[item].SoItem.ProductSKU__c}
                                                    </td>
                                                    <td class="invoice-table-fld-th" style="width:6.05%"><img src="{!soRelatedList[item].SoItem.ProductImageUrl__c}"
                                                                                                              width="70px" height="45px" />
                                                    </td>
                                                    <td class="invoice-table-fld-th" valign="center" style="width:6.05%">${!soRelatedList[item].customPrice}</td>
                                                    <td class="invoice-table-fld-th" valign="center" style="width:6.05%">
                                                        <apex:inputcheckbox value="{!soRelatedList[item].iscustomPriceAvailable}" disabled="true" rendered="{!if(soRelatedList[item].SoItem.Products__r.RecordType.Name != 'Protection Plan',true,false)}" style="margin-top: 16px;">
                                                        </apex:inputcheckbox>
                                                    </td>
                                                    <apex:outputText escape="false" rendered="false"><!--{!if(selectRefund == 'Cancellation' || selectRefund == 'none',true,false)}-->
                                                        <td class="invoice-table-fld-th" valign="center" style="width:6.05%">{!soRelatedList[item].SoItem.Quantity__c}</td>
                                                    </apex:outputText>
                                                    <apex:outputText escape="false" rendered="true"><!--{!if(selectRefund == 'Compensation',true,false)}-->
                                                        <td class="invoice-table-fld-th" valign="center" style="width:6.05%">{!soRelatedList[item].SoItem.Quantity_Invoiced__c}</td>
                                                    </apex:outputText>
                                                    
                                                    <td class="invoice-table-fld-th" valign="center" style="width:6.05%">{!soRelatedList[item].SoItem.Quantity_Refunded__c}</td>
                                                    
                                                    <apex:outputText escape="false" rendered="{!if(selectRefund == 'none',true,false)}">
                                                        <td class="invoice-table-fld-th" valign="center" style="width:6.05%">
                                                            <apex:inputtext value="{!soRelatedList[item].qty}" disabled="true" style="width: 40px;margin: 12.1px;text-align:center;padding:0px !important;" />
                                                        </td>
                                                    </apex:outputText>
                                                    <apex:outputText escape="false" rendered="{!if(selectRefund != 'none',true,false)}">
                                                        <td id="inputId" class="invoice-table-fld-th" valign="center" style="width:6.05%">
                                                            <apex:inputtext value="{!soRelatedList[item].qty}" style="width: 40px;margin: 12.1px;text-align:center;padding:0px !important;"
                                                                            disabled="{!if(((selectRefund == 'Compensation' || selectRefund == 'Cancellation') ) && soRelatedList[item].SoItem.Products__r.RecordType.Name == 'Bundled',true,false)}"
                                                                            onchange="
                                                                                      var form = document.forms['inputId'];
                                                                                      var reg = new RegExp('^[0-9]+$'); 
                                                                                      if(this.value > {!soRelatedList[item].SoItem.Quantity_Invoiced__c} || this.value == '' || !reg.test(this.value))
                                                                                      {
                                                                                      alert('Please enter a valid quantity to Refund.'); 
                                                                                      this.value = {!soRelatedList[item].qty};
                                                                                      }
                                                                                      else 
                                                                                      {
                                                                                      if(this.value > {!soRelatedList[item].SoItem.Quantity_Invoiced__c} - {!soRelatedList[item].SoItem.Quantity_Refunded__c}) 
                                                                                      { 
                                                                                      alert('Qty to Refund should not greater than Quantity Ordered.'); 
                                                                                      this.value = {!soRelatedList[item].qty};
                                                                                      } 
                                                                                      else 
                                                                                      {
                                                                                      callupdatemethod();
                                                                                      }
                                                                                      }
                                                                                      "  onfocus="this.value = {!soRelatedList[item].qty};">
                                                            </apex:inputtext><!--&& soRelatedList[item].iscustomPriceAvailable == false-->
                                                        </td>
                                                    </apex:outputText>
                                                    <td class="invoice-table-fld-th" valign="center" style="width:4.05%">${!soRelatedList[item].subTotal}</td>
                                                    <td class="invoice-table-fld-th" valign="center" style="width:4%">${!soRelatedList[item].disAmount}</td>
                                                    <td class="invoice-table-fld-th" valign="center" style="width:4%">${!soRelatedList[item].taxAmount}</td>
                                                    <td class="invoice-table-fld-th" valign="center" style="width:4%">${!soRelatedList[item].rowTotal}</td>
                                                    <td class="invoice-table-fld-th" valign="center" style="width: 4.5%;">
                                                        <apex:outputText value="{!soRelatedList[item].weight}" rendered="{!!if(soRelatedList[item].SoItem.Products__r.RecordType.Name == 'Protection Plan',true,false)}" />
                                                        <apex:outputText value="NA" rendered="{!if(soRelatedList[item].SoItem.Products__r.RecordType.Name == 'Protection Plan',true,false)}" />
                                                    </td>
                                                    <td id="" class="invoice-table-fld-th" valign="center" style="width: 9.05%;">
                                                        <apex:inputText id="customRefundId" value="{!soRelatedList[item].customDisc}" style="margin: 12.1px;width:70px;text-align:center;padding:0px !important;" 
                                                                        onchange="
                                                                                  var reg = new RegExp('^[0-9.]+$'); 
                                                                                  var rowTot = {!soRelatedList[item].rowTotal};
                                                                                  if(!reg.test(this.value))
                                                                                  {
                                                                                  alert('Please enter a valid Custom Discount to Refund.'); 
                                                                                  this.value = {!soRelatedList[item].customDisc};
                                                                                  }
                                                                                  else if({!soRelatedList[item].qty} == '0')
                                                                                  {
                                                                                  alert('Please Select atleast one Quantity.');
                                                                                  this.value='0.00';
                                                                                  } 
                                                                                  else if(rowTot < this.value)
                                                                                  {
                                                                                  alert('Custom Refund should not greater then Total Paid amount.');
                                                                                  this.value='0.00';
                                                                                  }
                                                                                  else 
                                                                                  {
                                                                                  callupdatemethod();
                                                                                  }" disabled="{!!if(soRelatedList[item].SoItem.Products__r.recordtype.name!='Bundled' && (selectRefund == 'Compensation') && soRelatedList[item].SoItem.Quantity_Invoiced__c != soRelatedList[item].SoItem.Quantity_Refunded__c,true,false)}"
                                                                        rendered="{!!if(soRelatedList[item].SoItem.Products__r.RecordType.Name == 'Protection Plan',true,false)}">
                                                        </apex:inputText>
                                                        <apex:outputText value="NA" style="margin: 12.1px;width:50px;text-align:center" rendered="{!if(soRelatedList[item].SoItem.Products__r.RecordType.Name == 'Protection Plan',true,false)}" />
                                                    </td>
                                                    <td style="padding:0">
                                                        <apex:outputPanel layout="block" id="panelid" rendered="{!if(soRelatedList[item].SoItem.Products__r.recordtype.name=='Bundled',true,false)}" >
                                                            <table id="bundle-table" class="table table-striped table-bordered dataTable inv-inner-table" cellspacing="0"  role="grid" style="width: 1380px;">
                                                                <thead style="font-weight:bold;width: 99%;background: #F7F7F7;float: left;">
                                                                    <th class="invoice-table-fld-th" style="width: 2%;">&nbsp;</th>
                                                                    <th class="invoice-table-fld-first-th" style="width:16%">Product</th>
                                                                    <th class="invoice-table-fld-th" style="width:6%">Image</th>
                                                                    <th class="invoice-table-fld-th" style="width:6.15%">Price</th>
                                                                    <th class="invoice-table-fld-th" style="width:6%">Qty Invoiced</th>
                                                                    <th class="invoice-table-fld-th" style="width:6.05%">Qty Refunded</th>
                                                                    <th class="invoice-table-fld-th" style="width:6.15%">Qty to Refund</th>
                                                                    <apex:outputText escape="false" rendered="{!if((selectRefund == 'Compensation' || selectRefund == 'Cancellation'),true,false)}"><!--&& soRelatedList[item].iscustomPriceAvailable == false-->
                                                                        <th class="invoice-table-fld-th" style="width:5%">Sub Total</th>
                                                                        <th class="invoice-table-fld-th" style="width:5%">Dis. Amt</th>
                                                                        <th class="invoice-table-fld-th" style="width:5%">Tax Amt</th>
                                                                        <th class="invoice-table-fld-th" style="width:5%">Total Paid</th>
                                                                    </apex:outputText>
                                                                    <th class="invoice-table-fld-th" style="width:5%;">Wt. (lbs)</th>
                                                                    <th class="invoice-table-fld-th" style="width: 9.05%;">Custom Refund($)</th>
                                                                </thead>
                                                                <tbody style="height: auto;">
                                                                    <apex:repeat value="{!soRelatedList[item].bundleList}" var="bundleItem" rendered="{!if(soRelatedList[item].bundleList != null,true,false)}">
                                                                        <tr id="Bundel" role="row">
                                                                            <td style="width: 2%;">&nbsp;</td>
                                                                            <td class="invoice-table-fld-first-th" style="line-height: 1.8;width:16 %"><b>{!bundleItem.bundleSoItem.Product_Name__c}  {!if(bundleItem.bundleSoItem.Item__c == 'Cancelled',' - Cancelled' ,'')}</b><br/>
                                                                                <b>SKU : </b>{!bundleItem.bundleSoItem.ProductSKU__c}
                                                                            </td>
                                                                            
                                                                            <td class="invoice-table-fld-th" style="width:6%"><img src="{!bundleItem.bundleSoItem.ProductImageUrl__c}" width="70px" height="45px" />
                                                                            </td>
                                                                            <td class="invoice-table-fld-th" valign="center" style="width:6.15%">${!bundleItem.bundleSoItem.Price_For_Credit_Memo__c}</td>
                                                                            <td class="invoice-table-fld-th" valign="center" style="width:6%">{!bundleItem.bundleSoItem.Quantity_Invoiced__c}</td>
                                                                            <td class="invoice-table-fld-th" valign="center" style="width:6.05%">{!bundleItem.bundleSoItem.Quantity_Refunded__c}</td>
                                                                            <td class="invoice-table-fld-th" valign="center" style="width:6.15%">
                                                                                <apex:inputText id="bundleQtyId" value="{!bundleItem.bundleqty}" disabled="{!!if( (selectRefund == 'Compensation' || selectRefund == 'Cancellation') ,true,false)}" 
                                                                                                style="width: 40px;margin: 12.1px;text-align:center;padding:0px !important;"
                                                                                                onchange="
                                                                                                          var reg = new RegExp('^[0-9]+$'); 
                                                                                                          if(this.value > {!bundleItem.bundleSoItem.Quantity_Invoiced__c} || this.value == '' || !reg.test(this.value))
                                                                                                          {
                                                                                                          alert('Please enter a valid quantity to Refund.'); 
                                                                                                          this.value = {!bundleItem.bundleqty};
                                                                                                          }
                                                                                                          else 
                                                                                                          {
                                                                                                          if(this.value > {!bundleItem.bundleSoItem.Quantity_Invoiced__c} - {!bundleItem.bundleSoItem.Quantity_Refunded__c}) 
                                                                                                          { 
                                                                                                          alert('Qty to Refund should not greater than Quantity Ordered.'); 
                                                                                                          this.value = {!bundleItem.bundleqty};
                                                                                                          } 
                                                                                                          else 
                                                                                                          {
                                                                                                          callupdatemethod();
                                                                                                          }
                                                                                                          }
                                                                                                          "
                                                                                                /><!--&& soRelatedList[item].iscustomPriceAvailable == false-->
                                                                                <script type="text/javascript">
                                                                                window.onload = setFocus
                                                                                function setFocus() {
                                                                                    document.getElementById("inputId").focus();
                                                                                }
                                                                                </script>
                                                                            </td>
                                                                            <apex:outputText escape="false" rendered="{!if((selectRefund == 'Compensation' || selectRefund == 'Cancellation') ,true,false)}"><!--&& soRelatedList[item].iscustomPriceAvailable == false-->
                                                                                <td class="invoice-table-fld-th" valign="center" style="width:5%">${!bundleItem.subTotal}</td>
                                                                                <td class="invoice-table-fld-th" valign="center" style="width:5%">${!bundleItem.disAmount}</td>
                                                                                <td class="invoice-table-fld-th" valign="center" style="width:5%">${!bundleItem.taxAmount}</td>
                                                                                <td class="invoice-table-fld-th" valign="center" style="width:5%">${!bundleItem.rowTotal}</td>
                                                                            </apex:outputText>
                                                                            <td class="invoice-table-fld-th" valign="center" style="width:5%;">{!bundleItem.bundleSoItem.Total_Weight_Pounds__c}</td>
                                                                            <td id="" class="invoice-table-fld-th" valign="center" style="width: 9.05%;">
                                                                                <apex:inputText id="customRefundId" value="{!bundleItem.customDisc}" style="margin: 12.1px;width:70px;text-align:center;padding:0px !important;" 
                                                                                                onchange="
                                                                                                          var reg = new RegExp('^[0-9.]+$'); 
                                                                                                          var rowTot = {!bundleItem.rowTotal};
                                                                                                          if(!reg.test(this.value))
                                                                                                          {
                                                                                                          alert('Please enter a valid Custom Discount to Refund.'); 
                                                                                                          this.value = {!bundleItem.customDisc};
                                                                                                          }
                                                                                                          else if({!bundleItem.bundleqty} == '0')
                                                                                                          {
                                                                                                          alert('Please Select atleast one Quantity.');
                                                                                                          this.value='0.00';
                                                                                                          } 
                                                                                                          else if(rowTot < this.value)
                                                                                                          {
                                                                                                          alert('Custom Refund should not greater then Total Paid amount.');
                                                                                                          this.value='0.00';
                                                                                                          }
                                                                                                          else 
                                                                                                          {
                                                                                                          callupdatemethod();
                                                                                                          }" disabled="{!!if((selectRefund == 'Compensation') && bundleItem.bundleSoItem.Quantity_Invoiced__c != bundleItem.bundleSoItem.Quantity_Refunded__c,true,false)}"
                                                                                                rendered="{!!if( selectRefund != 'Compensation' || soRelatedList[item].SoItem.Products__r.RecordType.Name == 'Protection Plan',true,false)}">
                                                                                </apex:inputText>
                                                                                <!--apex:outputText value="NA" style="margin: 12.1px;width:50px;text-align:center" rendered="{!if(soRelatedList[item].SoItem.Products__r.RecordType.Name == 'Protection Plan',true,false)}" /-->
                                                                            </td>
                                                                        </tr>   
                                                                    </apex:repeat>
                                                                </tbody>
                                                            </table>   
                                                        </apex:outputPanel>
                                                    </td>
                                                </tr>
                                            </apex:outputText>
                                        </apex:repeat>
                                    </tbody>
                                </table>
                            </div>
                            <div style="margin-top: 20px; width: 100%; float: left;">
                                <apex:outputPanel rendered="{!if(selectRefund == 'Cancellation' || selectRefund == 'GPP Cancellation' || selectRefund == 'Edited order',true,false)}">
                                    <div style="margin-bottom: 10px; text-align: right;font-size: 15px;">
                                        <h5>
                                            SubTotal :
                                            <apex:outputText value="{0, number, $#,###,###,###,##0.00}"
                                                             style="text-align: center;width:10%">
                                                <apex:param value="{!subTot}" />
                                            </apex:outputText>
                                        </h5>
                                    </div>
                                    <div style="margin-bottom: 10px; text-align: right;font-size: 15px;">
                                        <h5>
                                            <apex:outputText value="Discount ({!SO_Obj.Promotion__r.Name}) :"  rendered="{!!if(SO_Obj.Promotion__r.Name == Null,true,false)}"/>
                                            <apex:outputText value="Discount :" rendered="{!if(SO_Obj.Promotion__r.Name == Null,true,false)}"/>
                                            <apex:outputText value="{0, number, $#,###,###,###,##0.00}"
                                                             style="text-align: center;width:10%"> 
                                                <apex:param value="{!disAmount}" />
                                            </apex:outputText>
                                            <p>
                                               
                                                <apex:inputCheckbox value="{!applayReward}" onchange="rewardChange()" rendered="{!if(SO_Obj.DiscountAmount__c != Null,true,false)}"/>  
                                                <apex:outputText id="rewardPoint" value="Reward Points : {!SO_Obj.DiscountAmount__c}" rendered="{!if(SO_Obj.DiscountAmount__c != Null,true,false)}" styleClass="{!if(applayReward==true,'reward-aplay','reward-not-aplay')}"/>
                                                <apex:actionFunction name="rewardChange" action="{!onChangecalcInvoice}" reRender="rewardPoint, formId, errorMsgId" />
                                            </p><!---->
                                        </h5> 
                                    </div>
                                    <apex:outputPanel rendered="{!if( selectRefund == 'GPP Cancellation' || selectRefund == 'Cancellation' && selectLocation != 'LTL Carrier Pickup due to Damage' && selectLocation != 'LTL Return Enroute to Consignment', true, false)}">
                                    <div style="margin-bottom: 10px; text-align: right;font-size: 15px;">
                                        <h5>
                                            Adjustment Refund :
                                            (<apex:inputText value="{!adjustRefundPercentage}" onchange="recalculateAdj();" style="width: 20px;"/>%)
                                            <apex:actionFunction name="recalculateAdj" action="{!onChangecalcInvoice}" reRender="formId" status="message" />
                                            <apex:outputText value="{0, number, $#,###,###,###,##0.00}"
                                                             style="text-align: center;width:10%">
                                                <apex:param value="{!adjustRefundTot}" />
                                            </apex:outputText>
                                        </h5>
                                    </div>
                                    </apex:outputPanel>
                                    <div style="margin-bottom: 10px; text-align: right;font-size: 15px;">
                                        <h5>
                                            Tax Amount :
                                            <apex:outputText value="{0, number, $#,###,###,###,##0.00}"
                                                             style="text-align: center;width:10%">
                                                <apex:param value="{!taxAmount}" />
                                            </apex:outputText>
                                        </h5>
                                    </div>
                                    <div style="margin-bottom: 10px; text-align: right;font-size: 15px;">
                                        <h5> Auto-populated Shipping Fee:
                                                $<apex:outputText value="{!defaultShippingfee}" style="text-align: center;width:5%"
                                                                    rendered="{!if( selectRefund == 'Cancellation' && selectRefund != 'Compensation',true,false)}">
                                                </apex:outputText>
                                        </h5>
                                        <p></p>
                                        <h5>
                                            Shipping Charges :
                                            $<apex:inputText value="{!shippingFee}" style="text-align: center;width:5%" onchange="getTotal();" 
                                                             rendered="{!if( selectRefund == 'Cancellation' && selectRefund != 'Compensation',true,false)}"><!--(selectLocation != 'Customer Location' && selectLocation !='Delivery Hub') -->
                                            </apex:inputText>
                                            <apex:actionFunction name="getTotal" action="{!shippingChargesCalculation}" reRender="formId" status="message" />
                                            <apex:outputText value="{!shippingFee}" style="text-align: center;width:10%"
                                                             rendered="{!if ( selectRefund == 'Cancellation' && selectRefund == 'Compensation',true,false)}"><!--(selectLocation == 'Customer Location' || selectLocation =='Delivery Hub')-->
                                            </apex:outputText>
                                        </h5>
                                    </div>
                                </apex:outputPanel>
                                <hr />
                                <div style="margin-bottom: 20px; text-align: right; font-size: 21px;">
                                    <apex:outputPanel rendered="{!if( (selectRefund == 'Cancellation' || selectRefund == 'GPP Cancellation') && selectLocation != 'LTL Carrier Pickup due to Damage' && selectLocation != 'LTL Return Enroute to Consignment',true,false)}">
                                        <h3>
                                            Total Refund ({!if( selectRefund == 'Cancellation','Cancellation',if(selectRefund == 'GPP Cancellation', 'GPP Cancellation','') )}) :
                                            <apex:outputText value="{0, number, $#,###,###,###,##0.00}"
                                                             style="text-align: center;width:10%">
                                                <apex:param value="{!grandTotal}" />
                                            </apex:outputText>
                                        </h3>
                                    </apex:outputPanel>
                                    <apex:outputPanel rendered="{!if( (selectRefund == 'Cancellation' || selectRefund == 'GPP Cancellation' ) && (selectLocation == 'LTL Carrier Pickup due to Damage' || selectLocation == 'LTL Return Enroute to Consignment'),true,false)}">
                                        <h3>
                                            Total Refund ({!if( selectRefund == 'Cancellation','Cancellation',if(selectRefund == 'GPP Cancellation', 'GPP Cancellation','') )}) :
                                            <apex:outputText value="{0, number, $#,###,###,###,##0.00}"
                                                             style="text-align: center;width:10%">
                                                <apex:param value="{!grandTotal}" />
                                            </apex:outputText>
                                        </h3>
                                    </apex:outputPanel>
                                    <apex:outputPanel rendered="{!!if(selectRefund == 'Cancellation' || selectRefund == 'Edited order' || selectRefund == 'none' || selectRefund == 'GPP Cancellation',true,false)}">
                                        <h3>
                                            Total Refund(Compensation) :
                                            <apex:outputText value="{0, number, $#,###,###,###,##0.00}"
                                                             style="text-align: center;width:10%">
                                                <apex:param value="{!customDiscount}" />
                                            </apex:outputText>
                                        </h3>
                                    </apex:outputPanel>
                                    <apex:outputPanel rendered="{!if(selectRefund == 'Edited order' || selectRefund == 'none',true,false)}">
                                        <h3>
                                            Total Refund(Edited order) :
                                            <apex:outputText value="{0, number, $#,###,###,###,##0.00}"
                                                             style="text-align: center;width:10%">
                                                <apex:param value="{!SO_Obj.Total_Due__c}" />
                                            </apex:outputText>
                                        </h3>
                                    </apex:outputPanel>
                                    
                                </div>
                                <div
                                     style="margin-bottom: 20px; text-align: right; font-size: 12px;">
                                    <p>
                                        <apex:inputCheckbox value="{!isChecked}" />
                                        Notify Customer by Email
                                    </p>
                                </div>
                            </div>
                            
                            <div class="create-invoice-btns">
                                
                                <apex:commandButton value="Submit Refund" id="Submitrefundid" onclick="lockSubmitButtons();" oncomplete="unLockSubmitButtons()" status="message"
                                                    action="{!submitRefund}" styleClass="refund-control-btns manstep3-savebtn"
                                                     rendered="{!NOT(isBlank(soRelatedList))}"/>
                                <apex:commandButton value="Cancel" action="/{!Sales_Order__c.id}" immediate="true"  onclick="lockSubmitButtons();" oncomplete="unLockSubmitButtons()"
                                                    styleClass="refund-control-btns manstep3-cancelbtn" style="width: 149px;margin-right:20px;" />
                            </div>
                            <!-- test table -->
                        </apex:outputPanel>
                    </div>
                </div>
            </body>
        </html>
    </apex:form>
</apex:page>